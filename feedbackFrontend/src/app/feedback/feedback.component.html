<div class="center-container">
  <mat-card class="form-card">
    <mat-card-content>
      <mat-form-field class="full-width">
        <mat-label>Your Role</mat-label>
        <mat-select
          [(ngModel)]="feedback.sender"
          placeholder="Your Role" required>
          <mat-option *ngFor="let option of roleOptionsFrom"
                      [value]="option[0]">
            {{ option[1] }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field *ngIf="feedback.sender!= null" class="full-width">
        <mat-label>Receiver Role</mat-label>
        <mat-select
          [(ngModel)]="feedback.receiver"
          placeholder="Receiver Role" required>
          <mat-option *ngFor="let option of roleOptionsTo"
                      [value]="option[0]">
            {{ option[1] }}
          </mat-option>
        </mat-select>
      </mat-form-field>

    <mat-form-field *ngIf="feedback.receiver!= null" class="full-width">
      <mat-label>AI Options</mat-label>
      <mat-select
        [(ngModel)]="aiOption"
        placeholder="AI Options" required>
        <mat-option *ngFor="let option of aiOptions"
                    [value]="option[0]">
          {{ option[1] }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    </mat-card-content>

    <div class="info-message" *ngIf=" aiOption === AI.CHECK && !check">
      <div style="margin-right: 10px">  <mat-icon>info</mat-icon></div>
      <span class="info-text"> Schreiben Sie das Feedback und klicken Sie dann auf 'Überprüfen'. Die KI überprüft den Text und verbessert ihn gegebenenfalls.</span>
    </div>

    <div class="info-message" *ngIf=" aiOption === AI.CREATE">
      <div style="margin-right: 10px">  <mat-icon>info</mat-icon></div>
      <span class="info-text">This is an CREATE informational message.</span>
    </div>

    <div class="info-message" *ngIf=" aiInteraction.aiGenerated && check">
      <div style="margin-right: 10px">  <mat-icon>info</mat-icon></div>
      <span class="info-text">>Die KI hat deinen Feedbacktext angepasst. Lies ihn noch einmal durch und korrigiere ihn gegebenenfalls. </span>
    </div>

    <div class="info-message" *ngIf="!aiInteraction.aiGenerated && check">
      <div style="margin-right: 10px">  <mat-icon>info</mat-icon></div>
      <span class="info-text">Die KI hat deinen Feedbacktext geprüft und keine Änderungen vorgenommen.  </span>
    </div>


    <mat-form-field *ngIf="aiOption === AI.CHECK " style="margin: 16px">
      <mat-label>Feedbacktext</mat-label>
      <textarea  #hinweistext
                 [(ngModel)]="aiInteraction.feedback"
                 minlength="100"
                 maxlength="1000"
                 matInput
                 rows="6">
        </textarea>
      <mat-hint align="end">{{ hinweistext.value.length }} / 1000</mat-hint>
      <mat-error *ngIf="hinweistext.value.length<100">
        Hinweistext must be at least 100 characters long.
      </mat-error>
    </mat-form-field>

    <mat-form-field *ngIf="aiOption === AI.CREATE " style="margin: 16px">
      <mat-label>Keywords</mat-label>
      <textarea  #hinweistext
                 [(ngModel)]="aiInteraction.feedback"
                 maxlength="1000"
                 minlength="40"
                 matInput
                 rows="6">
        </textarea>
      <mat-hint align="end">{{ hinweistext.value.length }} / 1000</mat-hint>
      <mat-error *ngIf="hinweistext.value.length<50">
        Hinweistext must be at least 50 characters long.
      </mat-error>
    </mat-form-field>

    <div class="button-container">
      <button *ngIf="aiInteraction.feedback.length> 100 && !check && aiOption != AI.CREATE"  mat-raised-button (click)="checkText(aiInteraction)"  color="primary">Check</button>
      <button *ngIf="aiInteraction.feedback.length> 50 && !create && aiOption != AI.CHECK"  mat-raised-button (click)="createText(aiInteraction)"  color="primary">Create</button>
      <button *ngIf="check || create" mat-raised-button (click)="createFeedback(aiInteraction)" color="primary">Send</button>
    </div>
  </mat-card>
</div>
<div *ngIf="isLoading" class="overlay">
  <div class="spinner-container">
    <mat-spinner></mat-spinner>
  </div>
</div>
